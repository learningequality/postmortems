# Title: 
### Buildkite kolibri builds failing due to upgraded docker image

# Events/Timeline:
- When running pex file generated by buildkite with Python3.6, found an error as follows:
  ```
  lingyiwang$ python3 kolibri-0.6.dev020170821165952-git.pex
  
  Traceback (most recent call last):
  File "/usr/local/Cellar/python3/3.6.2/Frameworks/Python.framework/Versions/3.6/lib/python3.6/runpy.py", line 193, in _run_module_as_main "__main__", mod_spec) 
  File "/usr/local/Cellar/python3/3.6.2/Frameworks/Python.framework/Versions/3.6/lib/python3.6/runpy.py", line 85, in _run_code exec(code, run_globals) 
  File "kolibri-0.6.dev020170821165952-git.pex/__main__.py", line 25, in <module> File
  "/Users/lingyiwang/Downloads/kolibri-0.6.dev020170821165952-git.pex/.bootstrap/_pex/pex_bootstrapper.py", line 94, in bootstrap_pex 
  File "/Users/lingyiwang/Downloads/kolibri-0.6.dev020170821165952-git.pex/.bootstrap/_pex/finders.py", line 218, in register_finders
  
  AttributeError: module 'importlib._bootstrap' has no attribute 'FileFinder'
  ```
- Tested on Mac OS X and Vagrant's ubuntu VM to created a pex file with Python2.7, worked with Python3.6 on my laptop. 
- Tested on docker with the latest ubuntu:xenial image to create a pex file with Python2.7, worked with Python3.6 on my laptop.
- Thought this could be a Python compatability issue, so built a pex file with Python3.6 on my laptop, but it worked correctly.
- Mr. A recommendated updating the ubuntu image on Vader since many dependencies were installed using caches downloaded before. 
- Used `docker pull ubuntu:xenial` command to pull the latest ubuntu image on Vader and started to build kolibri on the new docker image. 
- Buildkite's kolibri build was timed out when building the windows installer, due to the need to accept a license agreement inside the docker container.
- Not able to fix this issue by putting `yes` before running `apt-get -y wine1.8`, which leads to the long sequence of builds in the schedule of buildkite.

# Cause
 - Updated ubuntu image on Vader affected all the kolibri builds directly and globally on buildkite since then.
 - Was not able to fix the issue as soon as possible, which casued the delay of other developers' builds.
 
# Short term fix
  - Retagged the old ubuntu image with *xenial* by calling `docker tag <old image ID> ubuntu:xenial` so that the new `ubuntu:xenial` image got changed to `ubuntu:<none>`. Since the Dockerfile we use get the ubuntu image by calling `FROM ubuntu:xenial`, everything works the same as before after retagging the image.
  
# Long term solution
 - Do not do `docker pull ubuntu:xenial` as it will overwrite the current `ubuntu:xenial` image in Vader.
 - There are two options to pull the new xenial image without interfering with the existing `ubuntu:xenial` image:
    - Go to the link for [all the ubuntu images' tags on docker](https://hub.docker.com/r/library/ubuntu/tags/) and find out other tag names for the new xenial image except *xenial*. For example, you can do `docker pull ubuntu:latest` or `docker pull ubuntu:xenial-20170802` to get the latest xenial image.
    - If accidentially did `docker pull ubuntu:xenial` and overwrote the image in Vader, retag the old image as soon as possible. When trying to use the new image, do `docker images ubuntu --digests` to locate the new image downloaded, which will usually be tagged with *none*, and find out its digest. Change your local Dockerfile's first line from `FROM ubuntu:xenial` to `FROM ubuntu:<digest>` to build the container based on the new xenial image without changing it globally, thus not interfering with other developers' builds.
